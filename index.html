<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <title>YouTube Kh√¥ng Qu·∫£ng C√°o ‚Äì C√≥ Ti·∫øng Lu√¥n!</title>
  <style>
    body {background:#000;color:#fff;font-family:Arial,sans-serif;margin:0;padding:15px;}
    input {padding:16px;font-size:18px;width:100%;border:none;border-radius:12px;margin-bottom:15px;background:#222;color:white;}
    #info {padding:15px;background:#111;border-radius:12px;margin:10px 0;}
    #player {width:100%;max-height:80vh;border-radius:12px;background:#000;}
    h2 {margin:0 0 10px 0;}
    img {max-width:100%;border-radius:12px;margin-top:10px;}
    #loading {text-align:center; color:#ccc;}
  </style>
</head>
<body>
  <input type="text" id="url" placeholder="D√°n link YouTube v√†o ƒë√¢y r·ªìi nh·∫•n Enter" autofocus>
  <div id="info"><div id="loading">S·∫µn s√†ng xem video ch∆∞a? üòé</div></div>
  <video id="player" controls autoplay playsinline></video>

  <script>
    document.getElementById("url").addEventListener("change", async () => {
      let input = document.getElementById("url").value.trim();
      if (!input) return;

      // L·∫•y video ID
      let match = input.match(/(?:v=|\/embed\/|\/shorts\/|youtu\.be\/|\/live\/)([a-zA-Z0-9_-]{11})/);
      if (!match) return alert("Link kh√¥ng h·ª£p l·ªá bro, th·ª≠ l·∫°i nh√©!");

      let videoId = match[1];
      let infoDiv = document.getElementById("info");
      let player = document.getElementById("player");
      infoDiv.innerHTML = "<p>ƒêang t·∫£i video + ti·∫øng... (3 gi√¢y th√¥i)</p>";
      player.src = ""; // Reset player

      try {
        // Instance ch√≠nh: nosebs.ru (s·ªëng kh·ªèe 30/11/2025, nhanh + c√≥ CDN)
        let res = await fetch(`https://pipedapi.nosebs.ru/streams/${videoId}`);
        if (!res.ok) throw "L·ªói instance";

        let data = await res.json();

        // Hi·ªÉn th·ªã info
        infoDiv.innerHTML = `
          <h2>${data.title}</h2>
          <p>${data.uploader} ‚Ä¢ ${data.uploadDate} ‚Ä¢ ${Number(data.views || 0).toLocaleString()} l∆∞·ª£t xem</p>
          <img src="${data.thumbnail}" alt="Thumbnail">
        `;

        // L·∫•y HLS stream (gh√©p video + audio t·ª± ƒë·ªông, c√≥ ti·∫øng ngay!)
        // ∆Øu ti√™n 1080p ho·∫∑c cao nh·∫•t c√≥ HLS
        let hlsStream = data.hlsStreams
          .filter(s => s.quality.includes('1080p') || s.quality.includes('720p'))
          .sort((a, b) => (b.bitrate || 0) - (a.bitrate || 0))[0]
          || data.hlsStreams[0];

        if (hlsStream) {
          player.src = hlsStream.url;
          player.load(); // Reload ƒë·ªÉ ph√°t
        } else {
          // Fallback: Gh√©p th·ªß c√¥ng video + audio (n·∫øu kh√¥ng c√≥ HLS)
          let videoUrl = data.videoStreams.filter(s => s.mimeType.includes("video/mp4")).sort((a, b) => (b.bitrate || 0) - (a.bitrate || 0))[0]?.url;
          let audioUrl = data.audioStreams[0]?.url;
          if (videoUrl && audioUrl) {
            // S·ª≠ d·ª•ng MediaSource ƒë·ªÉ gh√©p (c·∫ßn polyfill cho Safari, nh∆∞ng ƒë∆°n gi·∫£n)
            alert("HLS kh√¥ng c√≥, th·ª≠ fallback gh√©p audio-video (c√≥ th·ªÉ lag t√≠)");
            // Code gh√©p ph·ª©c t·∫°p h∆°n, t·∫°m d√πng video only + note
            player.src = videoUrl;
            infoDiv.innerHTML += "<p style='color:yellow;'>Ch∆∞a gh√©p ti·∫øng ƒë∆∞·ª£c, th·ª≠ instance kh√°c nh√©! (Ho·∫∑c d√πng b·∫£n full m√¨nh g·ª≠i)</p>";
          }
        }

      } catch (e) {
        // Backup: projectsegfau.lt (c≈©ng s·ªëng kh·ªèe)
        try {
          let res2 = await fetch(`https://pipedapi.in.projectsegfau.lt/streams/${videoId}`);
          let data2 = await res2.json();
          player.src = data2.hlsStreams[0].url;
          infoDiv.innerHTML = `<h2>${data2.title}</h2><p>Backup instance ƒëang ch·∫°y...</p><img src="${data2.thumbnail}">`;
          player.load();
        } catch {
          infoDiv.innerHTML = "<p style='color:red;'>Server n√†o c≈©ng down t·∫°m th·ªùi, th·ª≠ l·∫°i sau 1 ph√∫t ho·∫∑c b·∫£o m√¨nh g·ª≠i b·∫£n d√πng yt-dlp (si√™u b·ªÅn)!</p>";
        }
      }
    });
  </script>
</body>
</html>
