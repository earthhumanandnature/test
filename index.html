<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <title>YouTube Không Quảng Cáo</title>
  <style>
    body{background:#111;color:#fff;font-family:Arial,sans-serif;margin:0;padding:20px;}
    input{padding:16px;font-size:18px;width:100%;border:none;border-radius:8px;margin-bottom:20px;}
    #player{width:100%;max-height:80vh;border-radius:0;border-radius:12px;}
    #info{padding:15px;background:#1a1a1a;border-radius:12px;margin:10px 0;}
    img{max-width:100%;border-radius:12px;}
  </style>
</head>
<body>
  <input type="text" id="url" placeholder="Dán link YouTube vào đây rồi nhấn Enter">
  <div id="info"></div>
  <video id="player" controls autoplay playsinline></video>

  <script>
    document.getElementById("url").addEventListener("change", async () => {
      let url = document.getElementById("url").value.trim();
      if (!url) return;

      let m = url.match(/(?:v=|\/embed\/|\/shorts\/|youtu\.be\/|\/live\/)([^&?\/]+)/);
      if (!m) return alert("Link YouTube không hợp lệ");
      let videoId = m[1];

      try {
        let res = await fetch(`https://pipedapi.kavin.rocks/streams/${videoId}`);
        if (!res.ok) throw "API lỗi";
        let d = await res.json();

        document.getElementById("info").innerHTML = `
          <h2>${d.title || "Không có tiêu đề"}</h2>
          <p>${d.uploader} • ${d.uploadDate} • ${Number(d.views || 0).toLocaleString()} lượt xem</p>
          <img src="${d.thumbnail}">
        `;

        // Lấy link chất lượng cao nhất
        let best = d.videoStreams
          .filter(s => s.mimeType && s.mimeType.includes("mp4"))
          .sort((a,b) => (b.bitrate || 0) - (a.bitrate || 0))[0))[0];

        document.getElementById("player").src = best.url;

      } catch (e) {
        // Nếu instance chính chết → tự động chuyển sang instance khác
        let backup = `https://pipedapi.in.projectsegfau.lt/streams/${videoId}`;
        let res2 = await fetch(backup);
        let d2 = await res2.json();
        document.getElementById("player").src = d2.videoStreams[0].url;
        document.getElementById("info").innerHTML = `<h2>${d2.title}</h2>`;
      }
    });
  </script>
</body>
</html> 
